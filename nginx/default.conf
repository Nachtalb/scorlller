server {
    listen 80;

    # ─── Reddit JSON API proxy ───────────────────────────────────────────────
    # Trailing slash strips /proxy/reddit prefix before forwarding to upstream.
    # nginx uses OpenSSL → avoids Go TLS fingerprint that causes Reddit 403/429.
    location /proxy/reddit/ {
        # CORS preflight
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin  "*";
            add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS";
            add_header Access-Control-Max-Age       "86400";
            return 204;
        }

        proxy_pass              https://www.reddit.com/;
        proxy_ssl_server_name   on;

        proxy_set_header Host               "www.reddit.com";
        proxy_set_header User-Agent         "scorlller/2.0 by Nachtalb";
        proxy_set_header Cookie             "";
        proxy_set_header Referer            "";
        proxy_set_header X-Forwarded-For   "";
        proxy_set_header X-Forwarded-Host  "";
        proxy_set_header X-Forwarded-Proto "";
        proxy_set_header X-Real-IP          "";
        proxy_set_header Via                "";
        proxy_set_header Forwarded          "";

        proxy_hide_header Set-Cookie;

        add_header Access-Control-Allow-Origin  "*" always;
        add_header Access-Control-Allow-Methods "GET, HEAD, OPTIONS" always;
    }

    # ─── TODO: redgifs, preview.redd.it, SPA static serving ─────────────────
    location / {
        return 502 "not yet implemented\n";
    }
}
